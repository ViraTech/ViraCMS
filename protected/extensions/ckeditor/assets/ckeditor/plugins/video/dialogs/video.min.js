CKEDITOR.dialog.add("video",function(f){var a=f.lang.video;function e(j,l){var k=this.getValue();if(!k&&this.id=="id"){k=h()}j.setAttribute(this.id,k);if(!k){return}switch(this.id){case"poster":l.backgroundImage="url("+k+")";break;case"width":l.width=k+"px";break;case"height":l.height=k+"px";break}}function b(n,o,k){var j=this.id.match(/(\w+)(\d)/),p=j[1],m=parseInt(j[2],10);var l=k[m]||(k[m]={});l[p]=this.getValue()}function g(j){if(j){this.setValue(j.getAttribute(this.id))}else{if(this.id=="id"){this.setValue(h())}}}function c(n,k){var j=this.id.match(/(\w+)(\d)/),o=j[1],m=parseInt(j[2],10);var l=k[m];if(!l){return}this.setValue(l[o])}function h(){var j=new Date();return"video"+j.getFullYear()+j.getMonth()+j.getDate()+j.getHours()+j.getMinutes()+j.getSeconds()}var d=function(){var j=this.previewImage;j.removeListener("load",d);j.removeListener("error",i);j.removeListener("abort",i);this.setValueOf("info","width",j.$.width);this.setValueOf("info","height",j.$.height)};var i=function(){var j=this.previewImage;j.removeListener("load",d);j.removeListener("error",i);j.removeListener("abort",i)};return{title:a.dialogTitle,minWidth:400,minHeight:200,onShow:function(){this.fakeImage=this.videoNode=null;this.previewImage=f.document.createElement("img");var j=this.getSelectedElement();if(j&&j.data("cke-real-element-type")&&j.data("cke-real-element-type")=="video"){this.fakeImage=j;var p=f.restoreRealElement(j),l=[],o=p.getElementsByTag("source","");if(o.count()==0){o=p.getElementsByTag("source","cke")}for(var k=0,n=o.count();k<n;k++){var m=o.getItem(k);l.push({src:m.getAttribute("src"),type:m.getAttribute("type")})}this.videoNode=p;this.setupContent(p,l)}else{this.setupContent(null,[])}},onOk:function(){var p=null;if(!this.fakeImage){p=CKEDITOR.dom.element.createFromHtml("<cke:video></cke:video>",f.document);p.setAttributes({controls:"controls"})}else{p=this.videoNode}var n={},o=[];this.commitContent(p,n,o);var m="",t="",r=a.linkTemplate||"",l=a.fallbackTemplate||"";for(var q=0;q<o.length;q++){var k=o[q];if(!k||!k.src){continue}m+='<cke:source src="'+k.src+'" type="'+k.type+'" />';t+=r.replace("%src%",k.src).replace("%type%",k.type)}p.setHtml(m+l.replace("%links%",t));var s=f.createFakeElement(p,"cke_video","video",false);s.setStyles(n);if(this.fakeImage){s.replace(this.fakeImage);f.getSelection().selectElement(s)}else{var j=new CKEDITOR.dom.element("DIV",f.document);f.insertElement(j);j.append(s)}},onHide:function(){if(this.previewImage){this.previewImage.removeListener("load",d);this.previewImage.removeListener("error",i);this.previewImage.removeListener("abort",i);this.previewImage.remove();this.previewImage=null}},contents:[{id:"info",elements:[{type:"hbox",widths:["","100px"],children:[{type:"text",id:"poster",label:a.poster,commit:e,setup:g,onChange:function(){var j=this.getDialog(),l=this.getValue();if(l.length>0){j=this.getDialog();var k=j.previewImage;k.on("load",d,j);k.on("error",i,j);k.on("abort",i,j);k.setAttribute("src",l)}}},{type:"button",id:"browse",hidden:"true",style:"display:inline-block;margin-top:10px;",filebrowser:{action:"Browse",target:"info:poster",url:f.config.filebrowserImageBrowseUrl||f.config.filebrowserBrowseUrl},label:f.lang.common.browseServer}]},{type:"hbox",widths:["33%","33%","33%"],children:[{type:"text",id:"width",label:f.lang.common.width,"default":400,validate:CKEDITOR.dialog.validate.notEmpty(a.widthRequired),commit:e,setup:g},{type:"text",id:"height",label:f.lang.common.height,"default":300,validate:CKEDITOR.dialog.validate.notEmpty(a.heightRequired),commit:e,setup:g},{type:"text",id:"id",label:"Id",commit:e,setup:g}]},{type:"hbox",widths:["","100px","75px"],children:[{type:"text",id:"src0",label:a.sourceVideo,commit:b,setup:c},{type:"button",id:"browse",hidden:"true",style:"display:inline-block;margin-top:10px;",filebrowser:{action:"Browse",target:"info:src0",url:f.config.filebrowserVideoBrowseUrl||f.config.filebrowserBrowseUrl,params:{mime:"video/mp4,video/webm"}},label:f.lang.common.browseServer},{id:"type0",label:a.sourceType,type:"select","default":"video/mp4",items:[["MP4","video/mp4"],["WebM","video/webm"]],commit:b,setup:c}]},{type:"hbox",widths:["","100px","75px"],children:[{type:"text",id:"src1",label:a.sourceVideo,commit:b,setup:c},{type:"button",id:"browse",hidden:"true",style:"display:inline-block;margin-top:10px;",filebrowser:{action:"Browse",target:"info:src1",url:f.config.filebrowserVideoBrowseUrl||f.config.filebrowserBrowseUrl,params:{mime:"video/mp4,video/webm"}},label:f.lang.common.browseServer},{id:"type1",label:a.sourceType,type:"select","default":"video/webm",items:[["MP4","video/mp4"],["WebM","video/webm"]],commit:b,setup:c}]}]}]}});