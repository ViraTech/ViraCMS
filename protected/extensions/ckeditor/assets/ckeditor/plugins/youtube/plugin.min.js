(function(){CKEDITOR.plugins.add("youtube",{lang:["en","pt","ja","hu","it","fr","tr","ru","de","ar","nl","pl","vi"],init:function(a){a.addCommand("youtube",new CKEDITOR.dialogCommand("youtube",{allowedContent:"iframe[!width,!height,!src,!frameborder,!allowfullscreen]; object param[*]"}));a.ui.addButton("Youtube",{label:a.lang.youtube.button,toolbar:"insert",command:"youtube",icon:this.path+"images/icon.png"});CKEDITOR.dialog.add("youtube",function(b){var c;return{title:a.lang.youtube.title,minWidth:500,minHeight:200,contents:[{id:"youtubePlugin",expand:true,elements:[{id:"txtEmbed",type:"textarea",label:a.lang.youtube.txtEmbed,autofocus:"autofocus",onChange:function(d){handleEmbedChange(this,d)},onKeyUp:function(d){handleEmbedChange(this,d)},validate:function(){if(this.isEnabled()){if(!this.getValue()){alert(a.lang.youtube.noCode);return false}else{if(this.getValue().length===0||this.getValue().indexOf("//")===-1){alert(a.lang.youtube.invalidEmbed);return false}}}}},{type:"html",html:a.lang.youtube.or+"<hr>"},{type:"hbox",widths:["70%","15%","15%"],children:[{id:"txtUrl",type:"text",label:a.lang.youtube.txtUrl,onChange:function(d){handleLinkChange(this,d)},onKeyUp:function(d){handleLinkChange(this,d)},validate:function(){if(this.isEnabled()){if(!this.getValue()){alert(a.lang.youtube.noCode);return false}else{c=ytVidId(this.getValue());if(this.getValue().length===0||c===false){alert(a.lang.youtube.invalidUrl);return false}}}}},{type:"text",id:"txtWidth",width:"60px",label:a.lang.youtube.txtWidth,"default":a.config.youtube_width!=null?a.config.youtube_width:"640",validate:function(){if(this.getValue()){var d=parseInt(this.getValue())||0;if(d===0){alert(a.lang.youtube.invalidWidth);return false}}else{alert(a.lang.youtube.noWidth);return false}}},{type:"text",id:"txtHeight",width:"60px",label:a.lang.youtube.txtHeight,"default":a.config.youtube_height!=null?a.config.youtube_height:"360",validate:function(){if(this.getValue()){var d=parseInt(this.getValue())||0;if(d===0){alert(a.lang.youtube.invalidHeight);return false}}else{alert(a.lang.youtube.noHeight);return false}}}]},{type:"hbox",widths:["55%","45%"],children:[{id:"chkRelated",type:"checkbox","default":a.config.youtube_related!=null?a.config.youtube_related:true,label:a.lang.youtube.chkRelated},{id:"chkOlderCode",type:"checkbox","default":a.config.youtube_older!=null?a.config.youtube_older:false,label:a.lang.youtube.chkOlderCode}]},{type:"hbox",widths:["55%","45%"],children:[{id:"chkPrivacy",type:"checkbox",label:a.lang.youtube.chkPrivacy,"default":a.config.youtube_privacy!=null?a.config.youtube_privacy:false},{id:"chkAutoplay",type:"checkbox","default":a.config.youtube_autoplay!=null?a.config.youtube_autoplay:false,label:a.lang.youtube.chkAutoplay}]},{type:"hbox",widths:["45%","55%"],children:[{id:"txtStartAt",type:"text",label:a.lang.youtube.txtStartAt,validate:function(){if(this.getValue()){var d=this.getValue();if(!/^(?:(?:([01]?\d|2[0-3]):)?([0-5]?\d):)?([0-5]?\d)$/i.test(d)){alert(a.lang.youtube.invalidTime);return false}}}},{id:"empty",type:"html",html:""}]}]}],onOk:function(){var i="";if(this.getContentElement("youtubePlugin","txtEmbed").isEnabled()){i=this.getValueOf("youtubePlugin","txtEmbed")}else{var g="//",k=[],f;var h=this.getValueOf("youtubePlugin","txtWidth");var e=this.getValueOf("youtubePlugin","txtHeight");if(this.getContentElement("youtubePlugin","chkPrivacy").getValue()===true){g+="www.youtube-nocookie.com/"}else{g+="www.youtube.com/"}g+="embed/"+c;if(this.getContentElement("youtubePlugin","chkRelated").getValue()===false){k.push("rel=0")}if(this.getContentElement("youtubePlugin","chkAutoplay").getValue()===true){k.push("autoplay=1")}f=this.getValueOf("youtubePlugin","txtStartAt");if(f){var j=hmsToSeconds(f);k.push("start="+j)}if(k.length>0){g=g+"?"+k.join("&")}if(this.getContentElement("youtubePlugin","chkOlderCode").getValue()===true){g=g.replace("embed/","v/");g=g.replace(/&/g,"&amp;");if(g.indexOf("?")==-1){g+="?"}else{g+="&amp;"}g+="hl=pt_BR&amp;version=3";i='<object width="'+h+'" height="'+e+'">';i+='<param name="movie" value="'+g+'"></param>';i+='<param name="allowFullScreen" value="true"></param>';i+='<param name="allowscriptaccess" value="always"></param>';i+='<embed src="'+g+'" type="application/x-shockwave-flash" ';i+='width="'+h+'" height="'+e+'" allowscriptaccess="always" ';i+='allowfullscreen="true"></embed>';i+="</object>"}else{i='<iframe width="'+h+'" height="'+e+'" src="'+g+'" ';i+='frameborder="0" allowfullscreen></iframe>'}}var d=this.getParentEditor();d.insertHtml(i)}}})}})})();function handleLinkChange(b,a){if(b.getValue().length>0){b.getDialog().getContentElement("youtubePlugin","txtEmbed").disable()}else{b.getDialog().getContentElement("youtubePlugin","txtEmbed").enable()}}function handleEmbedChange(b,a){if(b.getValue().length>0){b.getDialog().getContentElement("youtubePlugin","txtUrl").disable()}else{b.getDialog().getContentElement("youtubePlugin","txtUrl").enable()}}function ytVidId(a){var b=/^(?:https?:\/\/)?(?:www\.)?(?:youtu\.be\/|youtube\.com\/(?:embed\/|v\/|watch\?v=|watch\?.+&v=))((\w|-){11})(?:\S+)?$/;return(a.match(b))?RegExp.$1:false}function hmsToSeconds(d){var b=d.split(":"),c=0,a=1;while(b.length>0){c+=a*parseInt(b.pop(),10);a*=60}return c};